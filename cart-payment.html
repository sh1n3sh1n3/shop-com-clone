<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="./cart-payment.css" />
  </head>
  <body>
    <header>
      <section id="head-main">
<!-- ---------------------left section header--------------------------- -->
          <section id="section-left">
              <div id="section-left-div"><a href="index.html"><img src="https://img.shop.com/Image/resources/logos/shop-logo-us-thanksgiving.svg" alt=""></a></div>
              <div>
                  <span href="" id="categories-tag" onclick="togglebmenu()">
                    <span class="material-symbols-outlined">
                      menu
                      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
                      
                    </span>
                    <p style="font-family:san-serif ;">Categories</p>
                  </span>
              </div>
          </section>
          
<!-- ---------------------right section header------------------ -->
          <section id="section-right">
              <div id="section-right-top">
                  <div id="section-right-top-left">
                      <form action="">
                          <div id="search-bar">
                              <div>
                                  <select name="select" id="header-select">
                                      <option value="">All Dpartment</option>
                                      <option value="">Auto</option>
                                      <option value="">Baby</option>
                                      <option value="">Beauty</option>
                                      <option value="">Books</option>
                                      <option value="">Business</option>
                                      <option value="">Cameras</option>
                                      <option value="">Cloths</option>
                                      <option value="">Collectibles</option>
                                      <option value="">Computers</option>
                                  </select>
                              </div>
                              <hr>
                              <div id="header-input-div">
                                  <input type="text" id="header-input" placeholder="Search SHOP.COM...">
                              </div>
                              <div>
                                  <button id="header-search-button" onclick="inputsumbit()">
                                      <span class="material-symbols-outlined">
                                          search
                                          <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
                                          </span>
                                  </button>
                              </div>
                          </div>
                      </form>
                  </div>
                  <div id="header-right-image">
                      <img src="https://www.shop.com/feo-cdn/_/d/3hhCIyNJE.webp" alt="">
                  </div>
              </div>
              <div id="section-right-btm">
                  <section id="header-right-btm-list">
                      <p><a href="product.html">Exclusive Brands</a></p>
                      <p><a href="product.html">Stores</a></p>
                      <p><a href="product.html">Deals</a></p>
                      <p><a href="product.html">SHOP Travel</a></p>
                      <p><a href="product.html">Departments</a></p>
                      <p><a href="product.html">ShopBuddy</a></p>
                  </section>
                  <div id="header-right-btm-btn">
                      <div>
                          <a  onclick="toggleAcc()">
                              <span class="material-symbols-outlined">
                                    person
                                   <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />
                              </span>
                              <p class="login-btn-text" id="userName" >LogIn/SignIn</p>
                          </a>
                      </div>
                      <div>
                          <a href="">
                              <span class="material-symbols-outlined">
                                  replay
                                  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />
                              </span>
                              <p class="login-btn-text">Orders</p>
                          </a>
                      </div>
                      <div>
                          <a href="cart-payment.html">
                            <!-- <box-icon name='cart' type='solid' animation='spin' ></box-icon> -->
                              <span class="material-symbols-outlined">
                                  shopping_cart
                                  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,1,0" />
                              </span>
                              <p class="login-btn-text">Cart</p>
                          </a>
                      </div>
                  </div>
              </div>
          </section>
      </section>
  </header>
    <h1 id="heading-cart">Your Cart</h1>
    <div id="cart-payment-div">
      <div id="shipment-div">
        <div class="h2-div"><h2>Shipment from Cutter & Buck</h2></div>
        <div id="learn-div">
          <i class="fa-solid fa-truck"></i>
          <p>
            <span>Add $71.05 </span>in Market America products to qualify for
            <span>Free Shipping!</span><a href="">Learn More</a>
          </p>
        </div>

        <!-- append add to cart products -->
        <div id="cart-product"></div>
        <!-- <div id="store-total">
        <div>
            <p>Store total:</p>
        </div>
        <div><h3><span>00.00</span></h3></div>
    </div> -->
      </div>
      <div id="payment-div">
        <div class="h2-div"><h2>Order Total</h2></div>
        <div id="div-subtitle">
          <div><p>Subtotal:</p></div>

          <div id="price-div">
            <p><span id="grandt">00.00</span></p>
          </div>
        </div>
        <div id="para-div">
          <p>
            or 4 interest-free payments of <span> $78.75</span> with
            <span id="sezzle-logo">
              <img
                src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTvT6H9nTPQz5iV1UTSTcIXxf2xm-2xNweadg&usqp=CAU"
                alt=""
            /></span>
            <span id="se-text">Sezzleⓘ</span>
          </p>
        </div>
        <div id="zip-code">
          <input id="code-input" type="text" placeholder="Coupon code" />
          <button id="shipping-btn">Estimate Discount</button>
        </div>
        <button id="checkout">Proceed to Checkout</button>
        <div id="checkout-card">
          <p id="checkout-para">or checkout with:</p>
          <button class="checkout-btn">
            <img
              src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRBruR0EDIS7IV0QVnT08qljzTPWe2tV1mf9A&usqp=CAU"
              alt=""
            /></button
          ><br />
          <button class="checkout-btn">
            <img
              src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQvnFEmcR5xO7MYeIOG06op5H_tZEMrJD5jFg&usqp=CAU"
              alt=""
            /></button
          ><br />
          <button class="checkout-btn">
            <img
              src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQO0FyJqdkSYeLMEJGPbtS0geAZk6reEBRvuA&usqp=CAU"
              alt=""
            /></button
          ><br />
        </div>
      </div>
    </div>
<!-- -------------------------------------footer section----------------------------------------- -->
<footer>
  <div id="footer-main">
    <div id="footer-div-1"><b>Link To This Page & Tell All Your Friends!</b>
         <button onclick="myFunction()">Copy Link</button>
    </div>
    <!-- <hr> -->
    <div id="footer-div-2">
      <a href=""><b>About Us</b> </a>|
      <a href=""><b>Help</b> </a>|
      <a href=""><b>Accessiblity Statement</b> </a>|
      <a href=""><b>Contact Us</b> </a>|
      <a href=""><b>Partner With Us</b> </a>|
      <a href=""><b>Services</b> </a>|
      <a href=""><b>Country/Region</b> </a>|
      <a href=""><b>Connect</b> </a>|
      <a href=""><b>Own your own SHOP site</b> </a>
    </div>
    <div id="footer-div-3">
      <p>© 1997-2022 Market America, Inc. or its affiliates. All other designated trademarks, copyrights, and brands are the property of their respective owners.</p>
      <p>Only Customers will receive cashback on qualifying purchases. UnFranchise Owners/Shop Consultants will receive increased IBV instead of cashback on qualifying purchases.</p>
      <p><a href="">Privacy Policy |</a><a href="">Terms of Use</a><a href="">Advertising Disclosure |</a><a href="">Return Policy |</a><a href="">Shipping Information</a> </p>
    </div>
    <div id="footer-div-4">
      <img src="https://www.shop.com/feo-cdn/7/F/BIyWLz__s.webp" alt="">
      <img src="https://www.shop.com/feo-cdn/B/L/K5pf_0c94.webp" alt="">
      <img src="https://www.shop.com/feo-cdn/m/S/eK8gl_JjY.webp" alt="">
      <img src="https://www.shop.com/feo-cdn/0/q/U9W4qM8Kw.webp" alt="">
      <img src="https://www.shop.com/feo-cdn/b/Y/U8fhRaNAg.webp" alt="">
      <img src="https://www.shop.com/feo-cdn/N/z/XfD9Uvd_o.webp" alt="">
      <img src="https://www.shop.com/feo-cdn/K/F/E44Pe49Qs.webp" alt="">
      <img src="https://www.shop.com/feo-cdn/n/U/D-6J9dXTA.webp" alt="">
    </div>
    <div id="footer-div-5">
      <img src="https://seal.digicert.com/seals/cascade/?tag=mcRGO2B9&referer=www.shop.com&format=png&lang=en&seal_number=3&seal_size=m" alt="">
    </div>
  </div>
</footer>
  </body>
</html>
<script>
  let count = 0;
  let price = [];
  var totalCount;

  let displayTotal = (arr) => {
    totalCount = 0;
    for (let i of arr) {
      totalCount += i;
    }
    console.log(totalCount);
    localStorage.setItem("finelPrice", JSON.stringify(totalCount));
    document.getElementById("grandt").innerText ="$ "+ totalCount;
  };

  display = (obj) => {
    price = [0];
    document.getElementById("cart-product").innerHTML = "";

    // console.log(obj.length);
    obj.map(({ name, finalPrice, category, url, cashback }, ind) => {
      // console.log(ind);
      let main_div = document.createElement("div");
      main_div.setAttribute("id", "main");
      let img_div = document.createElement("div");
      let img = document.createElement("img");
      img.src = url;
      img_div.append(img);

      let title_div = document.createElement("div");
      title_div.className = "titleclass";
      let title_head = document.createElement("h4");
      title_head.textContent = name;
      let price_val = document.createElement("h3");
      price_val.textContent = "$ " + finalPrice;
      // price.push(+finalPrice);
      price[ind] = +finalPrice;

      let back = document.createElement("p");
      back.textContent = "+" + cashback + " cashback";
      let code_no = document.createElement("h4");
      let code = "#Y4G3";
      code_no.textContent = code;
      let cata = document.createElement("p");
      cata.textContent = category;

      let qty = document.createElement("h4");
      qty.textContent = "Quantity";
      let select = document.createElement("select");
      select.setAttribute("id", "selected");
      select.addEventListener("change", function () {
        valspan.innerText ="$ "+ +select.value * +finalPrice;
        updateSubprice(ind, +select.value, +finalPrice);
      });
      for (let i = 1; i < 11; i++) {
        let option = document.createElement("option");
        option.textContent = i;
        select.append(option);
      }
      let qtydiv = document.createElement("div");
      qtydiv.append(qty, select);
      qtydiv.className = "qtyclass";

      title_div.append(title_head, price_val, back, code_no, cata, qtydiv);

      let button_div = document.createElement("div");
      let removebtn = document.createElement("button");
      removebtn.innerText = "Remove";
      removebtn.addEventListener("click", function () {
        removecart(ind);
      });
      button_div.append(removebtn);

      main_div.append(img_div, title_div, button_div);

      let storetotal = document.createElement("div");
      storetotal.setAttribute("id", "store-total");
      let storediv = document.createElement("div");
      let stp = document.createElement("p");
      stp.textContent = "Store Total:";
      let subval = document.createElement("div");
      let valspan = document.createElement("h3");
      valspan.setAttribute("id", "stprice");
      let num = 
      valspan.innerText = "$ "+ price[ind].toFixed(2);
      subval.append(valspan);
      storediv.append(stp);
      storetotal.append(storediv, subval);
      document.getElementById("cart-product").append(main_div, storetotal);
    });
    displayTotal(price);
    // console.log(obj);
  };

  let arrOfId = JSON.parse(localStorage.getItem("idlistforcart"));
  console.log("the arr",arrOfId);

  let dataArr = [];
  let arrOfIdData = async (arr) => {
    await arr.map((elem, ind) => {
      //https://shop-json-server.onrender.com/users/
      fetch(`http://localhost:3000/users/${elem}`)
        .then((resp) => {
          return resp.json();
        })
        .then((mydata) => {
          console.log(mydata);
          dataArr[ind] = mydata;
        })
        .then(() => {
          display(dataArr);
        });
    });
  };

  arrOfIdData(arrOfId);

  function updateSubprice(ind, qty, price_val) {
    price[ind] = qty * price_val;
    // console.log(price);
    displayTotal(price);
  }

  function grandtotal() {
    let count = 0;
    obj.map();
  }

  function removecart(ind) {
    dataArr.splice(ind, 1);
    price.splice(ind, 1);
    arrOfId.splice(ind, 1);

    localStorage.setItem("idlistforcart", JSON.stringify(arrOfId));
    display(dataArr);
  }


  var aferCoupon = totalCount;
  console.log("fffff",totalCount);
  
  



  document.getElementById("shipping-btn").addEventListener("click", () => {
    let couponVal = document.getElementById("code-input").value;

    let Coupon = (totalCount * 80) / 100;

    if (couponVal === "shop20" && Coupon != aferCoupon) {
      alert("Coupon Code Applied!");
      aferCoupon = Coupon;
      document.getElementById("grandt").innerText = "$"+" "+ Coupon;
    } else if (couponVal === "shop20" && Coupon === aferCoupon) {
      alert("Coupon code already applied!");
    } else {
      alert("Invalid code");
    }
    console.log('fff2',aferCoupon);
  });

  document.getElementById("checkout").addEventListener("click",()=>{
    console.log(aferCoupon);
    if(aferCoupon){
        localStorage.setItem("finelPrice", JSON.stringify(aferCoupon));
    }
    window.location.href = "checkout.html";
  })

  var result = JSON.parse(localStorage.getItem("logindata"));
console.log(result);
result.map(function(elem){
  document.getElementById("userName").innerHTML= elem.name;
  document.getElementById("signout").innerHTML="Sign Out"
})


</script>
